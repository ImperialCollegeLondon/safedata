<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Building and releasing safedata â€¢ safedata</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css"><script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet"><script src="pkgdown.js"></script><meta property="og:title" content="Building and releasing safedata"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-title-body">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">safedata</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="articles/overview.html">An overview of the safedata package</a>
    </li>
    <li>
      <a href="articles/using_safe_data.html">Using the `safedata` package</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ImperialCollegeLondon/safedata/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>Building and releasing safedata</h1>
    </div>

<div id="building-and-releasing-safedata" class="section level1">
<p>This repository and package uses a number of systems that you need to be aware of if you plan to work with the codebase:</p>
<ul><li>Documentation for the package is maintained using <code>roxygen</code> and <code>pkgdown</code>.</li>
<li>The code should be checked using linting for consistent style.</li>
<li>The repository has (now) been set up to use the git flow system for controlling development and releases across branches.</li>
<li>The repository uses GitHub Actions to carry out continuous integration (CI).</li>
</ul><p>These notes provide a brief walk through for these systems and some package specific requirements for releases.</p>
<div class="section level2">
<h2 id="build-scripts">Build scripts<a class="anchor" aria-label="anchor" href="#build-scripts"></a></h2>
<p>The <code>build_scripts</code> folder in the repository contains scripts containing the code blocks used in some of the steps described below. All are set up to be run from directly inside the <code>build_scripts</code> directory. Scripts are described in context below</p>
</div>
<div class="section level2">
<h2 id="package-documentation">Package documentation<a class="anchor" aria-label="anchor" href="#package-documentation"></a></h2>
<p>With the <code>roxygen</code> package , all of the package documentation is located in one of three places:</p>
<ol style="list-style-type: decimal"><li>Markup inside the <code>R</code> source files - there are blocks of comments starting with <code>#'</code> that contain all of the documentation that goes into the normal R documentaion (<code>.Rd</code>) files.</li>
<li>Vignettes, formatted as <code>Rmarkdown</code> files in the <code>vignettes</code> directory.</li>
</ol><p>When the documentation has been changed then the <code>.Rd</code> files in <code>man</code> and any vignettes in <code>doc</code> can be built automatically. The key command is:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="ex">Rscript</span> -e <span class="st">"devtools::document()"</span></span></code></pre></div>
<p>These documentation pages are a key part of the package and so whenever the code changes, the documentation should be rebuilt before commits are made: this ensures that the full package is submitted to GitHub Actions.</p>
</div>
<div class="section level2">
<h2 id="website">Website<a class="anchor" aria-label="anchor" href="#website"></a></h2>
<p>In addition to using <code>roxygen</code> to maintain the in-package documentation, <code>safedata</code> also uses <code>pkgdown</code> to create a documentation website. The configuration for this is in the <code>_pkgdown.yml</code> file. This file typically only needs updating when new functions are added, as they need to be added into the reference structure. The website will contain an HTML version of the Rd files and vignettes but also extra content: for example <code>README.md</code> is used to create <code>index.html</code> and other markdown files can be used to provide other content.</p>
<p>Rebuilding the website uses two commands:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="ex">Rscript</span> -e <span class="st">" pkgdown::clean_site()"</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="ex">Rscript</span> -e <span class="st">" pkgdown::build_site()"</span></span></code></pre></div>
<p>This removes old files and recreates the website in the <code>docs</code> directory (<em>not</em> <code>doc</code>!). This directory is then automatically used by GitHub Pages to create the package website at:</p>
<p>()[<a href="https://imperialcollegelondon.github.io/safedata/" class="external-link uri">https://imperialcollegelondon.github.io/safedata/</a>]</p>
<p>The website files themselves are <em>not</em> part of the continuous integration of the package and having to build and then commit changes within <code>docs</code> is untidy. The <code>safedata</code> package therefore includes <code>docs</code> in the <code>.gitignore</code> file: you can have a local copy of the website but it is not managed by git.</p>
<p>Instead, a GitHub Action has been configured to run <code>pkgdown</code> - when a new release has passed checks, the action can be triggered in order to update the <code>gh-pages</code> branch using the most recent code.</p>
<p>For local use, the package and website build steps have been bundled together in <code>build_scripts/build_docs.sh</code>. However, note that there are two different things go</p>
</div>
<div class="section level2">
<h2 id="linting">Linting<a class="anchor" aria-label="anchor" href="#linting"></a></h2>
<p>The linting process inspects the R code files in the package to check they have a consistent coding and syntax style. The file <code>build_scripts/collect_lint.sh</code> runs the code linting and updates the file <code>lint.txt</code> in the package root.</p>
<p>The <code>.lintr</code> file in the package root is used to configure the linting and set any exclusions. This is currently done on a line by line basis to note specific exceptions. It is also possible to exclude code from linting using <code># nolint</code> tags in the source code, but Iâ€™m avoiding this to keep the code files relatively clean. It does mean that <code>.lintr</code> has to be updated if the line numbers of exceptions change.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a><span class="bu">cd</span> build_scripts</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="ex">./collect_lint.sh</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="repository-structure">Repository structure<a class="anchor" aria-label="anchor" href="#repository-structure"></a></h2>
<p>The package uses the Gitflow branching model for the package repository and the <code>git-flow</code> extensions to help manage this (<a href="https://github.com/nvie/gitflow" class="external-link"></a>).</p>
<p>Day to day development happens on the <code>develop</code> branch, although you can also create specific <code>feature</code> branches for new features. When you have code that you want to release as a new version then <code>git flow</code> is used to create a <code>release</code> branch that is used to check and make final changes. That <code>release</code> branch is then merged into <code>master</code> and tagged as the new release, and also back into <code>develop</code> to bring back last minute fixes. The <code>master</code> branch should really only ever see merges in from a <code>release</code> branch - you should not work on it directly.</p>
<p>The package uses semantic version numbering (<a href="https://semver.org/" class="external-link"></a>) and code on the development branch should use the prerelease token <code>9000</code>. This is explained in more detail below in the description of the release cycle.</p>
</div>
<div class="section level2">
<h2 id="github-actions">GitHub Actions<a class="anchor" aria-label="anchor" href="#github-actions"></a></h2>
<p>When commits are pushed to the Github origin then the package is automatically built and checked using GitHub Actions:</p>
<p><a href="https://github.com/ImperialCollegeLondon/safedata/actions" class="external-link"></a></p>
<p>Checking happens on all branches, so day to day commits to <code>develop</code> will be built as well as commits to <code>release</code> branches and the creation of new tagged versions on <code>master</code>.</p>
<p>If you have made changes that you do not want to be built and checked then you can include <code>[ci skip]</code> in the commit message, but the idea is that all changes should be checked so this is typically only used for documentation changes and the like.</p>
</div>
<div class="section level2">
<h2 id="release-cycle">Release cycle<a class="anchor" aria-label="anchor" href="#release-cycle"></a></h2>
<p>These are the steps needed to release a new version of <code>safedata</code>.</p>
<div class="section level3">
<h3 id="configure-git">Configure <code>git</code>
<a class="anchor" aria-label="anchor" href="#configure-git"></a></h3>
<p>It is easier if <code>git</code> is configured to push new tags along with commits. This essentially just means that new releases can be sent with a single commit, which is simpler and saves GitHub Actions from building both the the code commit and then the tagged version. This only needs to be set once.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">set</span> <span class="fu">git</span> config --global push.followTags true</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="update-the-example-directory">Update the example directory<a class="anchor" aria-label="anchor" href="#update-the-example-directory"></a></h3>
<p>The <code>safedata</code> package ships with a zipped <code>safedata</code> directory that is used in the code examples. The search functionality in <code>safedata</code> uses the live database via the API so, unless you update this example directory, running the search examples may return Zenodo record IDs that are missing from the example directory. This will create checking errors.</p>
<p>The file <code>build_scripts/refresh_example_dir.R</code> contains the code needed to the example directory with a freshly zipped copy with up to date indices. Of course, if someone publishes a new dataset before the release occurs, you may still get an error and have to repeat this step!</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a><span class="bu">cd</span> build_scripts</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="ex">Rscript</span> refresh_example_dir.R</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="update-the-vignette-objects">Update the vignette objects<a class="anchor" aria-label="anchor" href="#update-the-vignette-objects"></a></h3>
<p>The <code>safedata</code> package ships with a file <code>R/sysdata.rda</code> that contains all of the data displayed in the vignettes. This is so that the vignette code does not <em>require</em> an internet connection for the code to be run, which is safer for CRAN. By default, these files are used in the vignette build and the file is created using:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"></a><span class="bu">cd</span> build_scripts</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="ex">Rscript</span> vignette_objects.R</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="check-the-code">Check the code<a class="anchor" aria-label="anchor" href="#check-the-code"></a></h3>
<p>Releases start from the <code>develop</code> branch, with a bunch of commits that you want to release as a new version. Before you do anything, you should check that the current commit in <code>develop</code> is building correctly.</p>
<p>There are three steps. First, the package contains a test suite, which currently only checks that network failures are handled gracefully. Those have to be passing before the package can be built so:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"></a><span class="ex">Rscript</span> -e <span class="st">"devtools::test()</span></span></code></pre></div>
<p>If the tests pass, then the second step is to build and install the package with minimal checking to see that this works and to make sure all of the most recent updates are available in installed files</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1"></a> <span class="ex">R</span> CMD BUILD safedata --no-build-vignettes</span>
<span id="cb8-2"><a href="#cb8-2"></a> <span class="ex">R</span> CMD CHECK safedata_xxxxxxxx.tar.gz</span></code></pre></div>
<p>With these files all in place, you can now verify that the complete code packaging, documentation building and formal CRAN checking passes.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1"></a><span class="bu">cd</span> build_scripts</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="ex">./build_and_check.sh</span></span></code></pre></div>
<p>Because nearly all of the actual user changes happen in the vignette and R files, it is easy to forget to update the documentation, so a full checking process starts there. The code below runs the full checking process on your local machine. The code in <code>build_and_check.sh</code> is reproduced here to show the steps.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># a) Move into the source directory and update the documents</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="co">#    using Roxygen and pkgdown</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="bu">cd</span> safedata</span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="ex">Rscript</span> -e <span class="st">"devtools::document()"</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="ex">Rscript</span> -e <span class="st">" pkgdown::clean_site()"</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="ex">Rscript</span> -e <span class="st">" pkgdown::build_site()"</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="bu">cd</span> ../</span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co"># b) Build the package from the source directory</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="ex">R</span> CMD BUILD safedata</span>
<span id="cb10-11"><a href="#cb10-11"></a></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co"># c) Identify the version name that just got built from the </span></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="co">#    package DESCRIPTION file and then check it for CRAN</span></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="va">VERSION=$(</span><span class="fu">sed</span> -n -e <span class="st">'4p'</span> safedata/DESCRIPTION  <span class="kw">|</span> <span class="fu">cut</span> -d <span class="st">" "</span>  -f 2<span class="va">)</span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="ex">R</span> CMD CHECK --as-cran --run-donttest safedata_<span class="va">$VERSION</span>.tar.gz </span></code></pre></div>
<p>Two points to note:</p>
<ol style="list-style-type: decimal"><li>The built package and check output are saved in the parent directory of the repository, not in the repository itself.</li>
<li>The version built is the one in the <em>currently checked out branch</em>.</li>
</ol><p>The key file to look at is <code>safedata.Rcheck/00check.log</code>. This contains a long list of checks applied to the code. Look out for <code>NOTE</code>, <code>WARNING</code> and <code>ERROR</code> and resolve these issues before moving on. If you are checking in the <code>develop</code> branch then you will see a note saying <code>Version contains large components</code> - that is about to be fixed.</p>
<div class="section level4">
<h4 id="vignette-building">Vignette building<a class="anchor" aria-label="anchor" href="#vignette-building"></a></h4>
<p>By default, the vignettes should build without using the network to download resources. This can be verified by setting an environment variable and running from the package root:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1"></a><span class="bu">export</span> <span class="va">URL_DOWN=</span>TRUE</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="ex">Rscript</span> -e <span class="st">"pkgdown::build_articles()"</span></span></code></pre></div>
<p>However, the articles can also be built using the network by setting the following:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1"></a><span class="bu">export</span> <span class="va">BUILD_VIGNETTE_USING_REMOTE=</span>TRUE</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="ex">Rscript</span> -e <span class="st">"pkgdown::build_articles()"</span></span></code></pre></div>
<p>This is marginally better, because it is automatically up to date and contains more of the expected messages, which havenâ€™t been fully duplicated in the offline mode.</p>
</div>
</div>
<div class="section level3">
<h3 id="create-the-new-release-branch">Create the new release branch<a class="anchor" aria-label="anchor" href="#create-the-new-release-branch"></a></h3>
<p>If all is ok then the code is in theory ready to release. The following creates a new candidate branch containing the current <code>develop</code> code. You need to specify the upcoming release version number, so for example to release version <code>1.0.6</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">git</span> flow release start 1.0.6</span></code></pre></div>
<p>This will create the <code>release/1.0.6</code> branch and check it out.</p>
<p>You should now immediately update the <code>DESCRIPTION</code> file to match that version number. In this example, that should mean changing the previous development version number (<code>-9000</code> is used to indicate code in development between versions ):</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode txt"><code class="sourceCode default"><span id="cb14-1"><a href="#cb14-1"></a>Version: 1.0.5-9000</span></code></pre></div>
<p>to</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode txt"><code class="sourceCode default"><span id="cb15-1"><a href="#cb15-1"></a>Version: 1.0.6</span></code></pre></div>
<p>You can then commit that change:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">git</span> commit -m <span class="st">"Update version number"</span> DESCRIPTION</span></code></pre></div>
<p>At the moment, the <code>release</code> branch is only local. The release branch and code needs to be pushed to Github to be picked up GitHub Actions. There is a specific <code>git flow</code> command to do this:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">git</span> flow release publish 1.0.6</span></code></pre></div>
<p>This sends the release branch up to be checked. In addition, there is now a release branch on origin so any other last minutes fixes and commits can be pushed in order to check those.</p>
</div>
<div class="section level3">
<h3 id="checking-on-different-platforms">Checking on different platforms<a class="anchor" aria-label="anchor" href="#checking-on-different-platforms"></a></h3>
<p>The Git Action build process should now be underway for the <code>release</code> branch. Git Actions is configured (see <code>.github/workflows/check-standard.yaml</code>) to build the package under R stable on Ubuntu, Mac and Windows and R devel on Ubuntu.</p>
<p>Although Windows is included in the GitHub Actions testing environment, the R Project also maintains a Windows test environment that can be used. This needs a built copy of the <code>release</code> branch, so run <code>build_scripts/build_and_check.sh</code> again. This should create a newly built package with the new version number (e.g.Â <code>safedata_1.0.6.tar.gz</code>). If everything checked out ok before creating the release, this is really just updating the version name.</p>
<p>You then need to upload that file to <code>win-builder</code>. The python script <code>build_scripts/upload_to_win-builder.py</code> will do this for you - it is simply automating the process of using FTP to upload the current version for checking under both R stable and R devel. Note that <code>win-builder</code> communicates by email with the package maintainer (whoever has the <code>cre</code> flag in the <code>authors</code> section of the <code>DESCRIPTION</code> file.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1"></a><span class="ex">python</span> build_scripts/upload_to_win-builder.py</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="wait">Wait<a class="anchor" aria-label="anchor" href="#wait"></a></h3>
<p>Ideally what happens now is that the build and check process on GitHub Actions and <code>win-builder</code> all pass. You <strong>must</strong> wait for these checks to complete!</p>
<p>Obviously, if any errors or warnings crop up in the checking process, those should be fixed in the <code>release</code> branch. The changes should be committed and pushed to start a new round of GitHub Actions checking and you will need to rebuild and resubmit to <code>win-builder</code></p>
</div>
<div class="section level3">
<h3 id="final-edits">Final edits<a class="anchor" aria-label="anchor" href="#final-edits"></a></h3>
<p>There are some final edits to check you have made:</p>
<ul><li>Update <code>NEWS</code> to document the changes since the previous version</li>
<li>Update <code>cran-comments.md</code> to record the R versions and environments used for testing and the outcomes of those builds. This should all be <code>status: OK</code> but there might be notes that should be explained.</li>
</ul><p>You now should also build the final version of the release code to be submitted to CRAN:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1"></a><span class="bu">cd</span> build_scripts</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="ex">./build_and_check.sh</span></span></code></pre></div>
<p>That should create the source package in the parent directory (e.g. <code>safedata-1.0.6.tar.gz</code>).</p>
<p>These edits and building will obviously also need to be committed and so there is likely to be one last round of CI runs, but this will just be documentation and information changes and so is unlikely to reveal new issues. Of course, if it does, youâ€™ll have to fix them!</p>
</div>
<div class="section level3">
<h3 id="finish-the-release">Finish the release<a class="anchor" aria-label="anchor" href="#finish-the-release"></a></h3>
<p>Once the <code>release</code> branch is passing checks on all platforms, then the candidate release is ready to be released as a version. Again using <code>1.0.6</code> as the example version number, the command is:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">git</span> flow release finish 1.0.6</span></code></pre></div>
<p>You will be asked for some commit messages and a new tag comment, which will simply be the version number. You should then be on the <code>develop</code> branch. You now need to checkout the <code>master</code> branch which should now have all the commits since the last release and a new tag with the version number. You can now push this to create the release - if youâ€™ve set the config described above then a single push will create the commit and tag.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">git</span> checkout master</span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="fu">git</span> push</span></code></pre></div>
<p>This will set off another round of GitHub Actions checking - you should see the tagged version being built and checked. This should all go cleanly!</p>
<p>You should now <strong>immediately</strong> get off the <code>master</code> branch and back onto <code>develop</code>, before you accidentally change the files or commit to it, You should also <strong>immediately</strong> update the version number in <code>DESCRIPTION</code>, adding <code>-9000</code> to show that this is now the development version from the new release. This is a trivial change, so we can use <code>[ci skip]</code> to avoid triggering Github Actions.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">git</span> checkout develop</span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="co"># Edit DESCRIPTION to e.g. version 1.0.6-9000</span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="fu">git</span> commit -m <span class="st">"Bump develop version [ci skip]"</span> DESCRIPTION</span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="fu">git</span> push</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="release-to-cran">Release to CRAN<a class="anchor" aria-label="anchor" href="#release-to-cran"></a></h3>
<p>You can then submit the built version of the source package that was created during the release process at: ()[<a href="https://cran.r-project.org/submit.html" class="external-link uri">https://cran.r-project.org/submit.html</a>]</p>
<p>You should take the up-to-date contents of <code>cran-comments.md</code> and copy that in the comments section of the submission form. The CRAN maintainers expect submitted packages to be functional and fully checked and these notes will help them see that the package has been properly checked.</p>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>

</div>



      <footer><div class="copyright">
  <p></p><p>Developed by Andy Aldersley, David Orme.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

